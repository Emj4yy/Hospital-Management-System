<!DOCTYPE html>
<html>
<head>
  <title>Prescriptions</title>
</head>
<body>
  
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/app.css?v=20251103004026" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <nav id="main-navbar-hm" class="navbar navbar-expand-lg navbar-light bg-white shadow-sm mb-4" role="navigation" aria-label="Main navigation">
        <div class="container">
            <a class="navbar-brand d-flex align-items-center text-decoration-none" href="/dashboard">
                <div class="brand-badge px-2 py-1 me-2" aria-hidden="true">HM</div>
                <div class="d-flex flex-column">
                    <span class="fw-bold">Hospital Management</span>
                    <small class="muted">Comprehensive â€¢ Caring â€¢ Efficient</small>
                </div>
            </a>

            <!-- quick-actions removed to simplify navbar visual - was: New Patient / Appointments / Billing buttons -->

            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto mb-2 mb-lg-0 align-items-lg-center">
                    <li class="nav-item"><a class="nav-link " href="/dashboard">Dashboard</a></li>
                    <li class="nav-item"><a class="nav-link " href="/patients">Patients</a></li>
                    <li class="nav-item"><a class="nav-link " href="/appointments">Appointments</a></li>
                    <li class="nav-item"><a class="nav-link " href="/doctors">Doctors</a></li>
                    <li class="nav-item"><a class="nav-link " href="/departments">Departments</a></li>
                    <li class="nav-item"><a class="nav-link " href="/admissions">Admissions</a></li>
                    <li class="nav-item"><a class="nav-link active" href="/prescriptions">Prescriptions</a></li>
                    <li class="nav-item"><a class="nav-link " href="/billing">Billing</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <script>
      (function(){
        // Robust duplicate-navbar remover:
        // - Ensures only the first navbar with the same brand text stays.
        // - Works even if header fragments are inserted later by observing DOM mutations.

        function removeDuplicateNavbars(){
          try{
            var navs = Array.prototype.slice.call(document.querySelectorAll('nav[id^="main-navbar-hm"]'));
            if(!navs || navs.length <= 1) return;

            // Use the first navbar as canonical. Remove any later navs that appear visually identical by brand text
            var canonical = navs[0];
            var canonicalBrand = (canonical.querySelector('.navbar-brand') || canonical).textContent.trim();

            for(var i = 1; i < navs.length; i++){
              var n = navs[i];
              var brand = (n.querySelector('.navbar-brand') || n).textContent.trim();
              // If brand matches (or if IDs clash), remove the duplicate instance.
              if(brand === canonicalBrand || n.id === canonical.id){
                n.parentNode && n.parentNode.removeChild(n);
              }
            }
          }catch(e){
            // no-op
          }
        }

        // Run on DOM ready
        if(document.readyState === 'loading'){
          document.addEventListener('DOMContentLoaded', removeDuplicateNavbars);
        } else {
          // already ready
          removeDuplicateNavbars();
        }

        // Observe DOM for later additions (debounced)
        var observer;
        try{
          var debounce;
          observer = new MutationObserver(function(mutations){
            if(debounce) clearTimeout(debounce);
            debounce = setTimeout(removeDuplicateNavbars, 80);
          });
          observer.observe(document.documentElement || document.body, {childList:true, subtree:true});

          // Stop observing after some time (safety) - navbars won't be added after initial render in normal cases
          setTimeout(function(){ observer.disconnect(); }, 5000);
        }catch(e){ /* MutationObserver not supported - fine */ }
      })();
    </script>
  <div class="container">
    <div class="page-title"><span class="emoji">ðŸ’Š</span><h1 class="m-0">Prescriptions</h1></div>
    <div id="alertPlaceholder"></div>
    
    <div class="form-section mb-3">
      <form id="prescriptionForm" class="row g-2 align-items-end">
        <div class="col-md-3">
          <label class="form-label visually-hidden">Patient</label>
          <select class="form-select" id="prPatientId" required>
            <option value="">Patient</option>
              <option value="1">Mayrielle Joy Latigo</option>
              <option value="3">John Michael Reyes</option>
              <option value="5">Maria Santos</option>
              <option value="6">Patricia Ann Dela Cruz</option>
          </select>
        </div>
        <div class="col-md-3">
          <label class="form-label visually-hidden">Doctor</label>
          <select class="form-select" id="prDoctorId" required>
            <option value="">Doctor</option>
              <option value="1">Dr. Angela Mendoza</option>
              <option value="2">Dr. Liza Dominguez</option>
              <option value="3">Dr. Katrina Villanueva</option>
              <option value="4">Dr. Raymond Gutierrez</option>
          </select>
        </div>
        <div class="col-md-4">
          <label class="form-label visually-hidden">Medications</label>
          <input class="form-control" id="prMedications" placeholder="Medications (comma separated)">
        </div>
        <div class="col-md-2">
          <button id="prAddBtn" class="btn btn-primary w-100" type="submit">Add</button>
        </div>
        <div class="col-12 mt-2"><input class="form-control" id="prNotes" placeholder="Notes"></div>
      </form>
    </div>
    <div class="table-responsive">
      <table class="table table-striped table-hover">
        <thead><tr><th>ID</th><th>Date</th><th>Patient</th><th>Doctor</th><th>Medications</th><th>Notes</th><th>Actions</th></tr></thead>
        <tbody>
            <tr data-prescription-id="1">
              <td>1</td>
              <td>2025-11-02</td>
              <td><a href="/patients/1">Mayrielle Joy Latigo</a></td>
              <td>Dr. Liza Dominguez <span class="muted small">(Obstetrics &amp; Gynecology)</span></td>
              <td>Paracetamol</td>
              <td></td>
              <td>
                <div class="d-flex gap-1">
                  <button class="btn btn-sm btn-danger pr-delete-btn" data-id="1">Delete</button>
                  <a href="/prescriptions/view/1" data-href="/prescriptions/view/1" class="btn btn-sm btn-outline-secondary pr-view-link">View</a>
                </div>
              </td>
            </tr>
                      <tr data-prescription-id="2">
              <td>2</td>
              <td>2025-11-02</td>
              <td><a href="/patients/3">John Michael Reyes</a></td>
              <td>Dr. Angela Mendoza <span class="muted small">(Cardiology)</span></td>
              <td>Ibuprofen</td>
              <td></td>
              <td>
                <div class="d-flex gap-1">
                  <button class="btn btn-sm btn-danger pr-delete-btn" data-id="2">Delete</button>
                  <a href="/prescriptions/view/2" data-href="/prescriptions/view/2" class="btn btn-sm btn-outline-secondary pr-view-link">View</a>
                </div>
              </td>
            </tr>
                      <tr data-prescription-id="3">
              <td>3</td>
              <td>2025-11-02</td>
              <td><a href="/patients/5">Maria Santos</a></td>
              <td>Dr. Katrina Villanueva <span class="muted small">(General Surgery)</span></td>
              <td>Insulin (Regular)</td>
              <td></td>
              <td>
                <div class="d-flex gap-1">
                  <button class="btn btn-sm btn-danger pr-delete-btn" data-id="3">Delete</button>
                  <a href="/prescriptions/view/3" data-href="/prescriptions/view/3" class="btn btn-sm btn-outline-secondary pr-view-link">View</a>
                </div>
              </td>
            </tr>
                  </tbody>
      </table>
    </div>
  </div>

  <script>
    (function(){
      const alertPlaceholder = document.getElementById('alertPlaceholder');
      // Robust navigation for View links: ensure anchors navigate via location.href to avoid accidental static-resource fetches
      document.querySelectorAll('.pr-view-link').forEach(a => a.addEventListener('click', function(e){
        // Let normal Ctrl/Cmd+click or middle-click behave naturally
        if (e.ctrlKey || e.metaKey || e.button === 1) return;
        e.preventDefault();
        const href = this.dataset.href || this.getAttribute('href');
        if(href) location.href = href;
      }));

      function showAlert(message, type){
        alertPlaceholder.innerHTML = `<div class="alert alert-FreeMarker template error (DEBUG mode; use RETHROW in production!):
The following has evaluated to null or missing:
==> type  [in template "freemarker/prescriptions/list.ftlh" at line 82, column 65]

----
Tip: If the failing expression is known to legally refer to something that's sometimes null or missing, either specify a default value like myOptionalVar!myDefault, or use <#if myOptionalVar??>when-present<#else>when-missing</#if>. (These only cover the last step of the expression; to cover the whole expression, use parenthesis: (myOptionalVar.foo)!myDefault, (myOptionalVar.foo)??
----

----
FTL stack trace ("~" means nesting-related):
	- Failed at: ${type}  [in template "freemarker/prescriptions/list.ftlh" at line 82, column 63]
----

Java stack trace (for programmers):
----
freemarker.core.InvalidReferenceException: [... Exception message was already printed; see it above ...]
	at freemarker.core.InvalidReferenceException.getInstance(InvalidReferenceException.java:134)
	at freemarker.core.EvalUtil.coerceModelToTextualCommon(EvalUtil.java:490)
	at freemarker.core.EvalUtil.coerceModelToStringOrMarkup(EvalUtil.java:410)
	at freemarker.core.EvalUtil.coerceModelToStringOrMarkup(EvalUtil.java:379)
	at freemarker.core.DollarVariable.calculateInterpolatedStringOrMarkup(DollarVariable.java:104)
	at freemarker.core.DollarVariable.accept(DollarVariable.java:63)
	at freemarker.core.Environment.visit(Environment.java:344)
	at freemarker.core.Environment.visit(Environment.java:350)
	at freemarker.core.Environment.process(Environment.java:323)
	at org.springframework.web.servlet.view.freemarker.FreeMarkerView.processTemplate(FreeMarkerView.java:447)
	at org.springframework.web.servlet.view.freemarker.FreeMarkerView.doRender(FreeMarkerView.java:351)
	at org.springframework.web.servlet.view.freemarker.FreeMarkerView.renderMergedTemplateModel(FreeMarkerView.java:302)
	at org.springframework.web.servlet.view.AbstractTemplateView.renderMergedOutputModel(AbstractTemplateView.java:181)
	at org.springframework.web.servlet.view.AbstractView.render(AbstractView.java:314)
	at org.springframework.web.servlet.DispatcherServlet.render(DispatcherServlet.java:1438)
	at org.springframework.web.servlet.DispatcherServlet.processDispatchResult(DispatcherServlet.java:1168)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1106)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:165)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:88)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:113)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:83)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:72)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:342)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:399)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:903)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1774)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:973)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:491)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:842)
